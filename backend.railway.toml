[build]
builder = "DOCKERFILE"
dockerfilePath = "backenddockerfile"

[deploy]
startCommand = "gunicorn app.main:app --bind 0.0.0.0:8000 --worker-class uvicorn.workers.UvicornWorker --workers 1 --threads 1 --timeout 30 --graceful-timeout 10 --keep-alive 5 --log-level debug --access-logfile - --error-logfile - --capture-output --preload"
healthcheckPath = "/health"
healthcheckPort = 8000
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[deploy.healthcheck]
path = "/health"
port = 8000
interval = "10s"
timeout = "5s"
retries = 3
startPeriod = "30s"

# 环境变量配置
[env]
ENV = "production"
PYTHONPATH = "/app/backend"
PORT = "8000"
WORKERS = "1"
WORKER_CLASS = "uvicorn.workers.UvicornWorker"
LOG_LEVEL = "debug"
PYTHONUNBUFFERED = "1"
WEB_CONCURRENCY = "1"
MAX_WORKERS = "1"
GUNICORN_THREADS = "1"
DATABASE_URL = "postgresql://postgres:VklXzDrDMygoJNZjzzSlNLMjmqKIPaYQ@postgres.railway.internal:5432/railway" 